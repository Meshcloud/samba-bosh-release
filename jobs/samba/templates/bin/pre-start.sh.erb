#!/bin/bash 
set -x
#Variable Setup
STORAGEPATH="/var/vcap/store/smbshare"
BOSHDIR="/var/vcap/jobs/samba/"
PASSWD_FILE="/var/vcap/store/.passwd*" 
USERGROUP=<%= p("smb.usergroup") %>
#install packages via apt
apt-get update
apt-get install samba -y

#Create the directory and set User Permissions
mkdir -p $STORAGEPATH
chown $USERGROUP $STORAGEPATH
chmod -R 700 $STORAGEPATH
#changing smb.conf smb conf
cat "$BOSHDIR/smb.conf" | tee -a "/etc/samba/smb.conf"
#restart service 
sudo service smbd restart
#move credential script to bin
cp "$BOSHDIR/bin/get_credentials" "/usr/local/bin/get_credentials.sh"
chmod a+x /usr/local/bin/get_credentials.sh

# move deletcredentials script to bin 
cp "$BOSHDIR/bin/delete_credentials" "/usr/local/bin/delete_credentials.sh"
chmod a+x /usr/local/bin/delete_credentials.sh

echo "done" | tee "/home/vcap/.status"
exit 0 


