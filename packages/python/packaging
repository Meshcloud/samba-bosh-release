# abort script on any command that exits with a non zero value
set -e -x

function packageInstallation(){
  echo "Extracting $1..."   
tar xzvf $1-$2.tar.gz

echo "Installing $1..."
pushd $1-$2
  /var/vcap/packages/python/bin/python setup.py install --prefix=$BOSH_INSTALL_TARGET
popd
}

PYTHON_VERSION=2.7
WERKZEUG_VERSION
PYCRYPTO_VERSION=2.6.1
JINJA_VERSION=2.10
SETUPTOOLS_VERSION=38.4.0
FLASK_VERSION=0.12.2
MARKUPSAFE_VERSION=1.0
ITSDANGEROUS_VERSION=0.24
CLICK_VERSION=6.7



cp -r python/* ${BOSH_INSTALL_TARGET}
cp -r pycrypto/* ${BOSH_INSTALL_TARGET}
cp -r werkzeug/* ${BOSH_INSTALL_TARGET}
cp -r jinja/* ${BOSH_INSTALL_TARGET}
cp -r setuptools/* ${BOSH_INSTALL_TARGET}
cp -r flask/* ${BOSH_INSTALL_TARGET}
cp -r markupsafe/* ${BOSH_INSTALL_TARGET}
cp -r itsdangerous/* ${BOSH_INSTALL_TARGET}
cp -r click/* ${BOSH_INSTALL_TARGET}



cd ${BOSH_INSTALL_TARGET}

echo "Extracting python..."
tar xzvf Python-${PYTHON_VERSION}.tar

echo "Building python..."
pushd Python-${PYTHON_VERSION}
  ./configure --prefix=$BOSH_INSTALL_TARGET
  make
  make install
popd

echo "Creating the site packages..."
mkdir -p $BOSH_INSTALL_TARGET/lib/python2.7/site-packages

echo "Setting the PYTHON_PATH with site packages..."
export PYTHON_PATH=$BOSH_INSTALL_TARGET/lib/python2.7/site-packages

packageInstallation "setuptools" $SETUPTOOLS_VERSION
packageInstallation "Werkzeug" $WERKZEUG_VERSION
packageInstallation "pycrypto" $PYCRYPTO_VERSION
packageInstallation "Jinja" $JINJA_VERSION
packageInstallation "MarkupSafe" $MARKUPSAFE_VERSION
packageInstallation "itsdangerous" $ITSDANGEROUS_VERSION
packageInstallation "click" $ITSDANGEROUS_VERSION
packageInstallation "flask" $FLASK_VERSION


